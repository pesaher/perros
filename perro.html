<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perro üêæ</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
      margin: 1em;
      color: #333;
      font-size: 16px;
    }
    @media (prefers-color-scheme: dark) {
      body {
        background: #1a1a1a;
        color: #e0e0e0;
      }
    }
    
    @media (max-width: 768px) {
      body {
        margin: 0.5em;
        font-size: 14px;
      }
    }
    
    .contenedor-perro {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 1.5em;
    }
    
    @media (prefers-color-scheme: dark) {
      .contenedor-perro {
        background: #2d2d2d;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      }
    }
    
    @media (max-width: 768px) {
      .contenedor-perro {
        padding: 1em;
        margin: 0.5em auto;
      }
    }
    
    .campos-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
      margin-bottom: 1.5em;
    }
    
    @media (max-width: 360px) {
      .campos-grid {
        grid-template-columns: 1fr;
        gap: 1em;
      }
    }
    
    .campo {
      margin-bottom: 0;
    }
    
    .campo-completo {
      grid-column: 1 / -1;
      margin-bottom: 1.2em;
    }
    
    @media (max-width: 768px) {
      .campo-completo {
        margin-bottom: 1em;
      }
    }
    
    .etiqueta {
      font-weight: bold;
      margin-bottom: 0.5em;
      color: #333;
      font-size: 0.9em;
    }
    
    @media (prefers-color-scheme: dark) {
      .etiqueta {
        color: #e0e0e0;
      }
    }
    
    .valor {
      padding: 0.7em;
      background: #f9f9f9;
      border-radius: 6px;
      border-left: 4px solid #4CAF50;
      font-size: 0.95em;
      min-height: 2.5em;
      display: flex;
      align-items: center;
    }
    
    @media (prefers-color-scheme: dark) {
      .valor {
        background: #3a3a3a;
      }
    }
    
    @media (max-width: 768px) {
      .valor {
        padding: 0.6em;
        font-size: 0.9em;
        min-height: 2.2em;
      }
    }
    
    .botones-inferiores {
      display: flex;
      gap: 1em;
      margin-top: 1em;
    }
    
    @media (max-width: 480px) {
      .botones-inferiores {
        flex-direction: column;
      }
    }
    
    .boton {
      display: inline-block;
      background: #2196F3;
      color: white;
      text-decoration: none;
      padding: 0.6em 1.2em;
      border-radius: 5px;
      font-size: 0.95em;
      border: none;
      cursor: pointer;
      text-align: center;
      flex: 1;
    }
    
    .boton:hover {
      opacity: 0.9;
    }
    
    .boton-volver {
      background: #2196F3;
    }
    
    .boton-editar {
      background: #FF9800;
    }
    
    .boton-guardar {
      background: #4CAF50;
    }
    
    .boton-cancelar {
      background: #f44336;
    }
    
    @media (max-width: 768px) {
      .boton {
        padding: 0.5em 1em;
        font-size: 0.9em;
        width: 100%;
        box-sizing: border-box;
      }
    }
    
    .nombre-perro {
      text-transform: uppercase;
      font-weight: bold;
      color: #000;
      text-align: center;
      font-size: 1.3em;
      justify-content: center;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      padding: 1em;
    }
    
    .nombre-contenedor {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1;
    }
    
    .icono-sexo {
      font-size: 1.2em;
    }
    
    .icono-reservado {
      position: absolute;
      left: 15px;
      font-size: 1.2em;
    }
    
    /* Colores seg√∫n el estado de reservado */
    .marco-reservado-null {
      background-color: #4CAF50 !important; /* Verde */
    }
    
    .marco-reservado-false {
      background-color: #87CEEB !important; /* Azul claro */
    }
    
    .marco-reservado-true {
      background-color: #D3D3D3 !important; /* Gris claro */
    }
    
    @media (max-width: 768px) {
      .nombre-perro {
        font-size: 1.1em;
      }
    }
    
    .protocolo-particular {
      background: #fff3cd !important;
      border-left-color: #ffc107 !important;
    }
    
    @media (prefers-color-scheme: dark) {
      .protocolo-particular {
        background: #5d4200 !important;
        border-left-color: #ffc107 !important;
      }
    }
    
    /* Estilos para modo edici√≥n */
    .campo-editable input,
    .campo-editable select,
    .campo-editable textarea {
      width: 100%;
      padding: 0.7em;
      border: 2px solid #2196F3;
      border-radius: 6px;
      font-size: 0.95em;
      background: white;
      box-sizing: border-box;
    }
    
    @media (prefers-color-scheme: dark) {
      .campo-editable input,
      .campo-editable select,
      .campo-editable textarea {
        background: #2d2d2d;
        color: #e0e0e0;
        border-color: #1976D2;
      }
    }
    
    .campo-editable textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }
  </style>
</head>
<body>
  <div class="contenedor-perro">
    <div id="contenido-perro">
      <!-- Aqu√≠ se cargar√°n los datos din√°micamente -->
    </div>
    
    <div class="botones-inferiores" id="botonesInferiores">
      <a href="javascript:history.back()" class="boton boton-volver">‚Üê Volver a Cheniles</a>
      <button class="boton boton-editar" id="btnEditar">‚úèÔ∏è Editar</button>
    </div>
  </div>

  <script>
    // Variables globales
    let datosOriginales = {};
    let modoEdicion = false;
    const nombrePerro = new URLSearchParams(window.location.search).get('nombre');
    
    if (!nombrePerro) {
      document.getElementById('contenido-perro').innerHTML = '<p>Error: No se especific√≥ el nombre del perro</p>';
    } else {
      cargarDatosPerro(nombrePerro);
    }
    
    function urlSinCache(nombre) {
      const base = `https://raw.githubusercontent.com/pesaher/perros/refs/heads/main/archivos/perros/${encodeURIComponent(nombre)}.json`;
      return base + '?v=' + Date.now();
    }

    async function cargarDatosPerro(nombre) {
      try {
        const url = urlSinCache(nombre);
        const respuesta = await fetch(url);
        
        if (!respuesta.ok) throw new Error('Perro no encontrado');
        
        const datosPerro = await respuesta.json();
        datosOriginales = JSON.parse(JSON.stringify(datosPerro));
        
        document.title = `${datosPerro.nombre && datosPerro.nombre.trim() !== '' ? datosPerro.nombre.toUpperCase() : 'JOHN DOGE'} üêæ`;
        mostrarDatosPerro(nombre, datosPerro);
        
      } catch (error) {
        document.getElementById('contenido-perro').innerHTML = `<p>Error al cargar los datos de ${nombre}: ${error.message}</p>`;
      }
    }

    // ... (las funciones calcularEdad y colorPastel se mantienen igual) ...

    function mostrarDatosPerro(nombre, datos, modoEdicion = false) {
      const contenedor = document.getElementById('contenido-perro');
      
      // Valores por defecto y formateo
      const nombreMostrar = datos.nombre && datos.nombre.trim() !== '' ? datos.nombre.toUpperCase() : 'JOHN DOGE';
      const edadMostrar = datos.nacimiento ? calcularEdad(datos.nacimiento) : '???';
      const pesoMostrar = datos.peso !== null && datos.peso !== undefined ? `${datos.peso} kg` : '???';
      const alturaMostrar = datos.altura !== null && datos.altura !== undefined ? `${datos.altura} cm` : '???';
      
      // Icono de sexo
      const iconoSexo = datos.macho === true ? '‚ôÇÔ∏è' : datos.macho === false ? '‚ôÄÔ∏è' : '';
      
      // Icono y color de reservado
      let iconoReservado = '';
      let claseReservado = '';
      
      if (datos.reservado === null) {
        iconoReservado = 'üîì';
        claseReservado = 'marco-reservado-null';
      } else if (datos.reservado === false) {
        iconoReservado = 'üîí';
        claseReservado = 'marco-reservado-false';
      } else if (datos.reservado === true) {
        iconoReservado = 'üîí';
        claseReservado = 'marco-reservado-true';
      }
      
      let html = `
        <div class="campos-grid">
          <!-- Nombre ocupa toda la fila con iconos -->
          <div class="campo-completo">
            <div class="valor nombre-perro ${claseReservado}">
              ${iconoReservado ? `<span class="icono-reservado">${iconoReservado}</span>` : ''}
              <div class="nombre-contenedor">
                ${modoEdicion ? 
                  `<input type="text" value="${datos.nombre || ''}" placeholder="Nombre del perro">` : 
                  nombreMostrar
                }
                ${!modoEdicion && iconoSexo ? `<span class="icono-sexo">${iconoSexo}</span>` : ''}
              </div>
            </div>
          </div>
          
          <!-- Campos en dos columnas -->
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Edad</div>
            <div class="valor">
              ${modoEdicion ? 
                `<input type="text" value="${datos.nacimiento || ''}" placeholder="YYYY, YYYY-MM o YYYY-MM-DD">` : 
                edadMostrar
              }
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Peso (kg)</div>
            <div class="valor">
              ${modoEdicion ? 
                `<input type="number" value="${datos.peso || ''}" placeholder="Peso en kg">` : 
                pesoMostrar
              }
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Altura (cm)</div>
            <div class="valor">
              ${modoEdicion ? 
                `<input type="number" value="${datos.altura || ''}" placeholder="Altura en cm">` : 
                alturaMostrar
              }
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Nivel de Paseo</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorPaseo(datos.paseo) : textoPaseo}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Sociable con Perros</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorSociablePerros(datos.sociableConPerros) : textoSociablePerros}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Sociable con Personas</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorSociablePersonas(datos.sociableConPersonas) : textoSociablePersonas}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Sociable con Gatos</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorBooleano('sociableConGatos', datos.sociableConGatos) : textoSociableGatos}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Protecci√≥n de Recursos</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorBooleano('proteccionDeRecursos', datos.proteccionDeRecursos) : textoProteccionRecursos}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Leishmania</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorBooleano('leishmania', datos.leishmania) : textoLeishmania}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Macho</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorBooleano('macho', datos.macho) : (datos.macho === true ? 'S√≠' : datos.macho === false ? 'No' : '???')}
            </div>
          </div>
          
          <div class="campo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Reservado</div>
            <div class="valor">
              ${modoEdicion ? crearSelectorReservado(datos.reservado) : ''}
            </div>
          </div>
        </div>
      `;
      
      // Protocolo particular
      if (!modoEdicion || datos.protocoloParticular) {
        html += `
          <div class="campo-completo ${modoEdicion ? 'campo-editable' : ''}">
            <div class="etiqueta">Protocolo Particular</div>
            <div class="valor ${!modoEdicion ? 'protocolo-particular' : ''}">
              ${modoEdicion ? 
                `<textarea placeholder="Protocolo particular...">${datos.protocoloParticular || ''}</textarea>` : 
                (datos.protocoloParticular ? datos.protocoloParticular.replace(/\n/g, '<br>') : '')
              }
            </div>
          </div>
        `;
      }
      
      contenedor.innerHTML = html;
    }

    // Funciones para crear selectores en modo edici√≥n
    function crearSelectorPaseo(valorActual) {
      const opciones = {
        '': '???',
        '0': 'Pasea bien',
        '1': 'Miedo (gestionable)',
        '2': 'Miedo (bloqueo)',
        '3': 'Reactivo',
        '4': 'Tira'
      };
      
      return crearSelectorGenerico('paseo', opciones, valorActual);
    }

    function crearSelectorSociablePerros(valorActual) {
      const opciones = {
        '': '???',
        '0': 'S√≠',
        '1': 'Selectivo',
        '2': 'No'
      };
      
      return crearSelectorGenerico('sociableConPerros', opciones, valorActual);
    }

    function crearSelectorSociablePersonas(valorActual) {
      const opciones = {
        '': '???',
        '0': 'S√≠',
        '1': 'Selectivo',
        '2': 'Mal con hombres',
        '3': 'No'
      };
      
      return crearSelectorGenerico('sociableConPersonas', opciones, valorActual);
    }

    function crearSelectorBooleano(nombre, valorActual) {
      const opciones = {
        '': '???',
        'true': 'S√≠',
        'false': 'No'
      };
      
      return crearSelectorGenerico(nombre, opciones, valorActual);
    }

    function crearSelectorReservado(valorActual) {
      const opciones = {
        'null': 'üîì Disponible',
        'false': 'üîí Reservado (azul)',
        'true': 'üîí Reservado (gris)'
      };
      
      return crearSelectorGenerico('reservado', opciones, valorActual);
    }

    function crearSelectorGenerico(nombre, opciones, valorActual) {
      let html = `<select name="${nombre}">`;
      
      for (const [valor, texto] of Object.entries(opciones)) {
        const seleccionado = valor === String(valorActual) ? 'selected' : '';
        html += `<option value="${valor}" ${seleccionado}>${texto}</option>`;
      }
      
      html += '</select>';
      return html;
    }

    // Manejadores de eventos
    document.getElementById('btnEditar').addEventListener('click', activarModoEdicion);

    function activarModoEdicion() {
      modoEdicion = true;
      mostrarDatosPerro(nombrePerro, datosOriginales, true);
      
      // Cambiar botones
      document.getElementById('botonesInferiores').innerHTML = `
        <button class="boton boton-cancelar" id="btnCancelar">‚úó Cancelar</button>
        <button class="boton boton-guardar" id="btnGuardar">üíæ Guardar</button>
      `;
      
      document.getElementById('btnCancelar').addEventListener('click', cancelarEdicion);
      document.getElementById('btnGuardar').addEventListener('click', guardarCambios);
    }

    function cancelarEdicion() {
      modoEdicion = false;
      mostrarDatosPerro(nombrePerro, datosOriginales, false);
      restaurarBotonesNormales();
    }

    function restaurarBotonesNormales() {
      document.getElementById('botonesInferiores').innerHTML = `
        <a href="javascript:history.back()" class="boton boton-volver">‚Üê Volver a Cheniles</a>
        <button class="boton boton-editar" id="btnEditar">‚úèÔ∏è Editar</button>
      `;
      document.getElementById('btnEditar').addEventListener('click', activarModoEdicion);
    }

    function guardarCambios() {
      // Recoger datos del formulario
      const formData = new FormData(document.querySelector('.campos-grid'));
      const datosActualizados = { ...datosOriginales };
      
      // Procesar campos
      datosActualizados.nombre = document.querySelector('input[type="text"]')?.value || '';
      datosActualizados.nacimiento = document.querySelector('input[placeholder*="YYYY"]')?.value || '';
      datosActualizados.peso = document.querySelector('input[placeholder*="Peso"]')?.value ? 
        parseInt(document.querySelector('input[placeholder*="Peso"]').value) : null;
      datosActualizados.altura = document.querySelector('input[placeholder*="Altura"]')?.value ? 
        parseInt(document.querySelector('input[placeholder*="Altura"]').value) : null;
      datosActualizados.protocoloParticular = document.querySelector('textarea')?.value || '';
      
      // Procesar selectores
      datosActualizados.paseo = formData.get('paseo') ? parseInt(formData.get('paseo')) : null;
      datosActualizados.sociableConPerros = formData.get('sociableConPerros') ? parseInt(formData.get('sociableConPerros')) : null;
      datosActualizados.sociableConPersonas = formData.get('sociableConPersonas') ? parseInt(formData.get('sociableConPersonas')) : null;
      datosActualizados.sociableConGatos = formData.get('sociableConGatos') === 'true' ? true : 
                                          formData.get('sociableConGatos') === 'false' ? false : null;
      datosActualizados.proteccionDeRecursos = formData.get('proteccionDeRecursos') === 'true' ? true : 
                                              formData.get('proteccionDeRecursos') === 'false' ? false : null;
      datosActualizados.leishmania = formData.get('leishmania') === 'true' ? true : 
                                    formData.get('leishmania') === 'false' ? false : null;
      datosActualizados.macho = formData.get('macho') === 'true' ? true : 
                               formData.get('macho') === 'false' ? false : null;
      datosActualizados.reservado = formData.get('reservado') === 'null' ? null : 
                                   formData.get('reservado') === 'true' ? true : 
                                   formData.get('reservado') === 'false' ? false : null;
      
      // Actualizar y salir del modo edici√≥n
      datosOriginales = datosActualizados;
      modoEdicion = false;
      mostrarDatosPerro(nombrePerro, datosActualizados, false);
      restaurarBotonesNormales();
      
      alert('Cambios guardados localmente');
      // Aqu√≠ podr√≠as a√±adir la l√≥gica para guardar en GitHub
    }

    // Funci√≥n calcularEdad (se mantiene igual)
    function calcularEdad(nacimiento) {
      if (!nacimiento) return '???';
      // ... (c√≥digo existente de calcularEdad)
    }

    // Funci√≥n colorPastel (se mantiene igual)
    function colorPastel(nombre) {
      // ... (c√≥digo existente de colorPastel)
    }
  </script>
</body>
</html>
